# ğŸ—ï¸ System Architecture

## High-Level Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SALESFORCE ORG                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   SALES     â”‚      â”‚    TANK      â”‚      â”‚  EXTERNAL  â”‚ â”‚
â”‚  â”‚   PROCESS   â”‚      â”‚  MANAGEMENT  â”‚      â”‚   APIs     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                     â”‚                     â”‚        â”‚
â”‚         â–¼                     â–¼                     â–¼        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              DECLARATIVE LAYER                        â”‚  â”‚
â”‚  â”‚  - Flows (Lead Conversion)                           â”‚  â”‚
â”‚  â”‚  - Process Builder (Tank Status)                     â”‚  â”‚
â”‚  â”‚  - Validation Rules (XOR constraint)                 â”‚  â”‚
â”‚  â”‚  - Formula Fields (Serial Number display)           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              PROGRAMMATIC LAYER                       â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚    LWC     â”‚  â”‚    APEX     â”‚  â”‚  TRIGGERS    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚            â”‚  â”‚             â”‚  â”‚              â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ tankMass   â”‚  â”‚ Tank        â”‚  â”‚ Tank         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Loader     â”‚  â”‚ Loader      â”‚  â”‚ Trigger      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚            â”‚  â”‚ Controller  â”‚  â”‚              â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚        â”‚                â”‚                 â”‚          â”‚  â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  â”‚
â”‚  â”‚                         â”‚                            â”‚  â”‚
â”‚  â”‚                         â–¼                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚         ASYNC PROCESSING                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - BitlyServiceQueueable                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - HTTP Callouts                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Named Credentials                         â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              DATA LAYER                               â”‚  â”‚
â”‚  â”‚  - Tank__c                                           â”‚  â”‚
â”‚  â”‚  - Tank_Type__c                                      â”‚  â”‚
â”‚  â”‚  - Order__c                                          â”‚  â”‚
â”‚  â”‚  - Lead (extended)                                   â”‚  â”‚
â”‚  â”‚  - Opportunity (extended)                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   BITLY API  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Interaction Diagram

### Sales Process Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ Creates Lead
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Lead Object          â”‚
â”‚ - Min_Price__c              â”‚
â”‚ - Max_Price__c              â”‚
â”‚ - Desired_Capacity__c       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Convert
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Flow: Lead to Opp       â”‚
â”‚  with Tank Match            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ Tank found? â”€â”€â”€â”€â”€â”€â”
         â”‚                    â”‚
       YES                   NO
         â”‚                    â”‚
         â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Opportunity  â”‚    â”‚ Opportunity  â”‚
â”‚ + Tank__c    â”‚    â”‚ + Order__c   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tank Creation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User opens tankMassLoader LWC      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: Select Tank Type           â”‚
â”‚  (@wire getTankTypes)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: Upload CSV file            â”‚
â”‚  (PapaParse parses client-side)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: Click Process              â”‚
â”‚  (Sends JSON to Apex)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TankLoaderController.createTanks() â”‚
â”‚  - Deserialize JSON                 â”‚
â”‚  - Build Tank__c objects            â”‚
â”‚  - Bulk insert (NO DML in loop)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TankTrigger fires                  â”‚
â”‚  - if (size == 1) â†’ Bitly           â”‚
â”‚  - if (size > 1) â†’ Skip Bitly       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼ (if single)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BitlyServiceQueueable (Async)      â”‚
â”‚  - Build URL                        â”‚
â”‚  - Call Bitly API                   â”‚
â”‚  - Update Tank.Bitly_Link__c        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Technology Stack

### Frontend Layer
- **Lightning Web Components (LWC)**
  - Modern JavaScript (ES6+)
  - Shadow DOM
  - Lightning Design System (SLDS)
  - PapaParse library (CSV parsing)

### Backend Layer
- **Apex**
  - Controllers (`@AuraEnabled`)
  - Triggers (Bulkified)
  - Queueable Jobs (Async)
  - Test Classes (98% coverage)

### Declarative Layer
- **Flow Builder**
  - Lead conversion automation
  - Tank matching logic
  - Order creation
  
- **Process Builder**
  - Tank status updates
  
- **Validation Rules**
  - XOR constraint (Tank vs Order)
  
- **Formula Fields**
  - Cross-object references

### Integration Layer
- **Named Credentials**
  - Secure token storage
  - Bitly API authentication
  
- **HTTP Callouts**
  - RESTful API calls
  - JSON serialization

---

## Data Model

### Entity Relationship Diagram

```
Tank_Type__c (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (N) Tank__c
      â”‚                           â”‚
      â”‚                           â”‚
      â”‚                      (1)  â”‚
      â”‚                           â”‚
      â””â”€â”€â”€â”€â”€ (N) Order__c â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€ (N) Opportunity
                    â”‚                          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€ (XOR) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           (only one)

Lead â”€â”€[Conversion]â”€â”€> Account + Contact + Opportunity
```

### Key Objects

1. **Tank_Type__c** (Master)
   - Tank categories
   - Reusable across multiple tanks

2. **Tank__c** (Detail)
   - Individual tank instances
   - Status: Available/Reserved/Sold
   - Links to Opportunities

3. **Order__c** (Custom Request)
   - When no Tank matches
   - Captures desired specifications
   - Links to Opportunities

4. **Opportunity** (Extended)
   - Either Tank OR Order (XOR)
   - Validation rule enforces constraint

---

## Security Architecture

### Permission Sets

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sales User  â”‚         â”‚ Tank Manager â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚
       â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Can:            â”‚     â”‚ Can:            â”‚
â”‚ - Lead CRUD     â”‚     â”‚ - Tank CRUD     â”‚
â”‚ - Opp CRUD      â”‚     â”‚ - Tank_Type CRUDâ”‚
â”‚ - Account CRUD  â”‚     â”‚ - Order Read    â”‚
â”‚                 â”‚     â”‚                 â”‚
â”‚ Cannot:         â”‚     â”‚ Cannot:         â”‚
â”‚ - Tank Edit     â”‚     â”‚ - Lead access   â”‚
â”‚ - Tank_Type Editâ”‚     â”‚ - Opp access    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Field-Level Security
- FLS enforced via `WITH SECURITY_ENFORCED`
- Permission Sets control field access
- Sharing Rules for record-level access

---

## Integration Points

### External Systems

| System | Protocol | Authentication | Purpose |
|--------|----------|----------------|---------|
| Bitly | HTTPS REST | Named Credential | Short URL generation |
| (Future) Analytics | REST | OAuth 2.0 | Reporting dashboards |
| (Future) ERP | SOAP | Basic Auth | Inventory sync |

---

## Scalability Considerations

### Performance Optimization

1. **Bulk Operations**
   - All Apex methods support bulk (200+ records)
   - No DML in loops
   - Efficient SOQL queries

2. **Async Processing**
   - Queueable for callouts
   - Future methods for long operations
   - Batch Apex for large data volumes

3. **Caching**
   - `@AuraEnabled(cacheable=true)` for LWC
   - Platform Cache for frequently accessed data

### Governor Limits Protection

- Single-record detection for callouts
- Bulk insert pattern throughout
- Test coverage for 200+ record scenarios

---

## Monitoring & Logging

### Debug Strategy

1. **Debug Logs**
   - Setup â†’ Debug Logs
   - User trace flags
   - Apex execution analysis

2. **System.debug() Statements**
   - LoggingLevel.ERROR for exceptions
   - Key decision points logged

3. **Event Monitoring**
   - Track API usage
   - Monitor performance
   - Identify bottlenecks

---

## Deployment Strategy

### Source-Driven Development

```bash
# Local development
sf project deploy start --source-dir force-app

# Sandbox deployment
sf project deploy start --target-org sandbox

# Production deployment
sf project deploy start --target-org production --test-level RunLocalTests
```

### CI/CD Pipeline (Future)

```
GitHub â†’ Jenkins â†’ Validate â†’ Deploy to Sandbox â†’ Run Tests â†’ Deploy to Prod
```

---

## Future Enhancements

- [ ] Einstein Analytics dashboards
- [ ] Mobile app with Salesforce Mobile SDK
- [ ] Scheduled batch for Tank maintenance
- [ ] Email notifications with Email Templates
- [ ] Chatter integration for collaboration
- [ ] Custom Lightning App for Tank Managers

---

## References

- [Salesforce DX Developer Guide](https://developer.salesforce.com/docs/atlas.en-us.sfdx_dev.meta/sfdx_dev/)
- [Lightning Web Components Dev Guide](https://developer.salesforce.com/docs/component-library/documentation/en/lwc)
- [Apex Developer Guide](https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/)

